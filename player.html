<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LeoTV Player</title>

<script src="https://cdn.jsdelivr.net/clappr/latest/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clappr-playback-rate-plugin@latest/dist/playback-rate.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body, html {
  width: 100%;
  height: 100%;
  background: #0a0a14;
  font-family: 'Cairo', sans-serif;
  overflow: hidden;
}

.player-container {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

#player-wrapper {
  flex: 1;
  position: relative;
  width: 100%;
  height: calc(100% - 70px);
}

#player {
  width: 100%;
  height: 100%;
}

.player-header {
  background: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%);
  color: white;
  padding: 15px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  height: 70px;
}

.channel-info {
  display: flex;
  align-items: center;
  gap: 15px;
}

.channel-logo {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  overflow: hidden;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
}

.channel-logo img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.channel-details h2 {
  font-size: 1.2rem;
  margin-bottom: 3px;
  font-weight: 600;
}

.channel-details p {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.7);
}

.controls {
  display: flex;
  gap: 10px;
  align-items: center;
}

.btn {
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: white;
  padding: 8px 15px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Cairo', sans-serif;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.3s;
}

.btn:hover {
  background: rgba(255, 255, 255, 0.2);
}

.btn i {
  font-size: 1rem;
}

.back-btn {
  background: rgba(102, 126, 234, 0.2);
  color: #667eea;
}

.back-btn:hover {
  background: rgba(102, 126, 234, 0.3);
}

.fullscreen-btn {
  background: rgba(76, 175, 80, 0.2);
  color: #4CAF50;
}

.fullscreen-btn:hover {
  background: rgba(76, 175, 80, 0.3);
}

.quality-badge {
  background: rgba(33, 150, 243, 0.2);
  color: #2196F3;
  padding: 5px 10px;
  border-radius: 6px;
  font-size: 0.8rem;
  font-weight: 600;
}

.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  color: white;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 3px solid rgba(255, 255, 255, 0.1);
  border-top: 3px solid #667eea;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.error-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.95);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  color: white;
  text-align: center;
  padding: 20px;
}

.error-overlay i {
  font-size: 3rem;
  color: #f44336;
  margin-bottom: 20px;
}

.error-overlay button {
  margin-top: 20px;
  background: #667eea;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-family: 'Cairo', sans-serif;
  font-size: 1rem;
}

/*===== إصلاح اللوغو بالقوة =====*/
.clappr-watermark,
.clappr-watermark[data-watermark],
div[data-watermark] img,
.player[data-watermark] img,
.player-poster[data-watermark] img {
  width: 40px !important;
  height: auto !important;
  position: absolute !important;
  left: 10px !important;
  bottom: 10px !important;
  top: auto !important;
  right: auto !important;
  z-index: 999999 !important;
  opacity: 0.9 !important;
  pointer-events: none !important;
}

@media (max-width: 768px) {
  .player-header {
    padding: 10px 15px;
    height: 60px;
  }
  
  .channel-details h2 {
    font-size: 1rem;
  }
  
  .btn {
    padding: 6px 10px;
    font-size: 0.8rem;
  }
  
  .channel-logo {
    width: 35px;
    height: 35px;
  }
}
</style>
</head>

<body>

<div class="player-container">
  <div class="player-header">
    <div class="channel-info">
      <div class="channel-logo">
        <img id="channel-logo" src="" alt="Channel Logo">
      </div>
      <div class="channel-details">
        <h2 id="channel-name">جاري التحميل...</h2>
        <p id="channel-group">Leo TV Player</p>
      </div>
    </div>
    
    <div class="controls">
      <div class="quality-badge" id="quality-display">HD</div>
      <button class="btn fullscreen-btn" onclick="toggleFullscreen()">
        <i class="fas fa-expand"></i>
        <span class="fullscreen-text">ملء الشاشة</span>
      </button>
      <button class="btn back-btn" onclick="goBack()">
        <i class="fas fa-arrow-right"></i>
        <span>العودة</span>
      </button>
    </div>
  </div>
  
  <div id="player-wrapper">
    <div id="player"></div>
    
    <div id="loading" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p>جاري تحميل البث...</p>
      <p style="font-size: 0.9rem; color: rgba(255,255,255,0.7); margin-top: 10px;" id="loading-url"></p>
    </div>
  </div>
</div>

<script>
// الحصول على باراميترات URL
const urlParams = new URLSearchParams(window.location.search);
const streamUrl = decodeURIComponent(urlParams.get('url') || '');
const channelName = decodeURIComponent(urlParams.get('name') || 'قناة غير معروفة');
const channelLogo = decodeURIComponent(urlParams.get('logo') || '');
const channelGroup = decodeURIComponent(urlParams.get('group') || 'beIN Sports');
const channelQuality = decodeURIComponent(urlParams.get('quality') || 'HD');

// تحديث المعلومات في الهيدر
document.getElementById('channel-name').textContent = channelName;
document.getElementById('channel-group').textContent = channelGroup;
document.getElementById('quality-display').textContent = channelQuality;
document.getElementById('loading-url').textContent = `جاري تحميل: ${streamUrl.substring(0, 50)}...`;

if (channelLogo) {
  document.getElementById('channel-logo').src = channelLogo;
  document.getElementById('channel-logo').onerror = function() {
    this.src = 'https://via.placeholder.com/40x40/1a1a2e/ffffff?text=TV';
  };
} else {
  document.getElementById('channel-logo').src = 'https://via.placeholder.com/40x40/1a1a2e/ffffff?text=TV';
}

// تحديث عنوان الصفحة
document.title = `${channelName} - LeoTV Player`;

let player;

function initializePlayer() {
  if (!streamUrl) {
    showError('لم يتم تحديد رابط البث');
    return;
  }
  
  try {
    player = new Clappr.Player({
      source: streamUrl,
      autoPlay: true,
      height: '100%',
      width: '100%',
      parentId: '#player',
      mute: false,
      volume: 100,
      
      // ووتر مارك مخصص لـ Leo TV
      watermark: 'https://g.top4top.io/p_3619x2ki01.png',
      position: 'bottom-left',
      watermarkLink: 'https://leotv.com',
      
      // إضافة إضافات
      plugins: [
        window.LevelSelector,
        window.PlaybackRatePlugin
      ],
      
      // إعدادات LevelSelector
      levelSelectorConfig: {
        title: 'جودة الفيديو',
        labels: {
          2: 'عالية (1080p)',
          1: 'متوسطة (720p)',
          0: 'منخفضة (480p)'
        }
      },
      
      // إعدادات PlaybackRate
      playbackRateConfig: {
        defaultValue: 1,
        options: [0.5, 0.75, 1, 1.25, 1.5, 2]
      },
      
      // إعدادات مشغل الفيديو
      mediacontrol: {
        seekbar: '#E3E3E3',
        buttons: '#FFFFFF'
      },
      
      // تفعيل خاصية البث المباشر
      hlsjsConfig: {
        enableWorker: true,
        liveSyncDurationCount: 3,
        liveMaxLatencyDurationCount: 10
      }
    });
    
    // إخفاء شاشة التحميل عند بدء التشغيل
    player.on('ready', function() {
      setTimeout(() => {
        document.getElementById('loading').style.display = 'none';
      }, 1000);
    });
    
    // معالجة الأخطاء
    player.on('error', function(error) {
      console.error('خطأ في المشغل:', error);
      showError('حدث خطأ في تحميل البث. يرجى المحاولة مرة أخرى.');
    });
    
    // حدث عند انتهاء البث
    player.on('ended', function() {
      showError('انتهى البث المباشر');
    });
    
  } catch (error) {
    console.error('خطأ في تهيئة المشغل:', error);
    showError('تعذر تشغيل المشغل. يرجى التحقق من المتصفح وإعادة المحاولة.');
  }
}

function showError(message) {
  document.getElementById('loading').style.display = 'none';
  
  const errorDiv = document.createElement('div');
  errorDiv.className = 'error-overlay';
  errorDiv.innerHTML = `
    <i class="fas fa-exclamation-triangle"></i>
    <h2>عذراً!</h2>
    <p>${message}</p>
    <button onclick="goBack()">العودة للقائمة الرئيسية</button>
    <button onclick="location.reload()" style="background: #4CAF50; margin-top: 10px;">إعادة المحاولة</button>
  `;
  
  document.getElementById('player-wrapper').appendChild(errorDiv);
}

function toggleFullscreen() {
  const elem = document.documentElement;
  
  if (!document.fullscreenElement) {
    if (elem.requestFullscreen) {
      elem.requestFullscreen();
    } else if (elem.webkitRequestFullscreen) {
      elem.webkitRequestFullscreen();
    } else if (elem.msRequestFullscreen) {
      elem.msRequestFullscreen();
    }
    
    document.querySelector('.fullscreen-text').textContent = 'تصغير';
    document.querySelector('.fullscreen-btn i').className = 'fas fa-compress';
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    } else if (document.webkitExitFullscreen) {
      document.webkitExitFullscreen();
    } else if (document.msExitFullscreen) {
      document.msExitFullscreen();
    }
    
    document.querySelector('.fullscreen-text').textContent = 'ملء الشاشة';
    document.querySelector('.fullscreen-btn i').className = 'fas fa-expand';
  }
}

function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.close();
  }
}

// التحكم في ملء الشاشة
document.addEventListener('fullscreenchange', updateFullscreenButton);
document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
document.addEventListener('mozfullscreenchange', updateFullscreenButton);
document.addEventListener('MSFullscreenChange', updateFullscreenButton);

function updateFullscreenButton() {
  if (document.fullscreenElement || 
      document.webkitFullscreenElement || 
      document.mozFullScreenElement || 
      document.msFullscreenElement) {
    document.querySelector('.fullscreen-text').textContent = 'تصغير';
    document.querySelector('.fullscreen-btn i').className = 'fas fa-compress';
  } else {
    document.querySelector('.fullscreen-text').textContent = 'ملء الشاشة';
    document.querySelector('.fullscreen-btn i').className = 'fas fa-expand';
  }
}

// اختصارات لوحة المفاتيح
document.addEventListener('keydown', function(e) {
  // مفتاح ESC للخروج من ملء الشاشة
  if (e.key === 'Escape' && document.fullscreenElement) {
    toggleFullscreen();
  }
  
  // مفتاح المسافة للتحكم في التشغيل/الإيقاف المؤقت
  if (e.key === ' ' && player) {
    e.preventDefault();
    player.isPlaying() ? player.pause() : player.play();
  }
  
  // مفاتيح الأسهم للتحكم في الصوت
  if (e.key === 'ArrowUp' && player) {
    e.preventDefault();
    const currentVolume = player.getVolume();
    player.setVolume(Math.min(currentVolume + 10, 100));
  }
  
  if (e.key === 'ArrowDown' && player) {
    e.preventDefault();
    const currentVolume = player.getVolume();
    player.setVolume(Math.max(currentVolume - 10, 0));
  }
});

// بدء تشغيل المشغل عند تحميل الصفحة
window.addEventListener('DOMContentLoaded', initializePlayer);
</script>

</body>
</html>
