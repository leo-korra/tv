<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Leo TV - Ù…Ø¹Ø¯Ù„</title>
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø§Øª HLS.js Ùˆ dash.js Ù…Ù† CDN -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/dashjs@latest/dist/dash.all.min.js"></script>
    <style>
        body { 
            margin: 0; 
            background: #000; 
            color: #fff; 
            font-family: 'Cairo', sans-serif;
            text-align: center;
        }
        video { 
            width: 100%; 
            height: 80vh; 
            display: block; 
            background: #111;
        }
        #status { 
            padding: 15px; 
            background: #222; 
            margin: 10px;
            border-radius: 8px;
            min-height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .error { 
            color: #ff6b6b; 
        }
        .success {
            color: #4ecdc4;
        }
        .controls {
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        .controls button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            transition: transform 0.2s;
        }
        .controls button:hover {
            transform: scale(1.05);
        }
        .info {
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            margin: 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>

    <video id="video" controls autoplay playsinline crossorigin="anonymous"></video>
    
    <div class="info" id="streamInfo">
        Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù‚Ù†Ø§Ø©...
    </div>
    
    <div class="controls">
        <button onclick="window.location.href='index.html'">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ù†ÙˆØ§Øª</button>
        <button onclick="refreshStream()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø«</button>
        <button onclick="toggleFullscreen()">ğŸ“º ÙˆØ¶Ø¹ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
    </div>
    
    <div id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯...</div>

    <script>
        const video = document.getElementById('video');
        const statusEl = document.getElementById('status');
        const streamInfoEl = document.getElementById('streamInfo');
        let currentStreamUrl = '';

        function updateStatus(msg, type = 'info') {
            statusEl.textContent = msg;
            statusEl.className = type;
            console.log(`${type === 'error' ? 'âŒ' : 'â„¹ï¸'} ${msg}`);
        }

        function updateStreamInfo(info) {
            streamInfoEl.innerHTML = info;
        }

        function initPlayer() {
            // 1. Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† URL Ù…Ù† Ù…Ø¹Ù„Ù…Ø© Ø§Ù„Ø±Ø§Ø¨Ø·
            const params = new URLSearchParams(window.location.search);
            const encodedUrl = params.get('src');
            
            if (!encodedUrl) {
                updateStatus('âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù‚Ù†Ø§Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.', 'error');
                
                // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªÙØµÙŠÙ„ÙŠØ©
                statusEl.innerHTML = `
                    <div style="margin: 20px;">
                        <h3>Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù‚Ù†Ø§Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h3>
                        <p>ÙŠØ¨Ø¯Ùˆ Ø£Ù†Ùƒ ÙØªØ­Øª ØµÙØ­Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø©.</p>
                        <button onclick="window.location.href='index.html'" 
                                style="padding: 15px 30px; 
                                       background: linear-gradient(135deg, #667eea, #764ba2); 
                                       color: white; 
                                       border: none; 
                                       border-radius: 10px; 
                                       font-size: 18px; 
                                       cursor: pointer; 
                                       margin-top: 20px;">
                            â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
                        </button>
                    </div>
                `;
                return;
            }

            // 2. ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
            let streamUrl;
            try {
                streamUrl = atob(decodeURIComponent(encodedUrl));
                updateStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©...', 'success');
                updateStreamInfo('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ØµØ¯Ø± Ø§Ù„Ø¨Ø«...');
            } catch (e) {
                streamUrl = decodeURIComponent(encodedUrl);
                updateStatus('Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©...', 'success');
                updateStreamInfo('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ØµØ¯Ø± Ø§Ù„Ø¨Ø«...');
            }

            // 3. Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentStreamUrl = streamUrl;
            
            // 4. Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø· (Ù…Ø®ØªØµØ±Ø©)
            const shortUrl = streamUrl.length > 50 ? 
                streamUrl.substring(0, 50) + '...' : 
                streamUrl;
            updateStreamInfo(`<strong>Ù…ØµØ¯Ø± Ø§Ù„Ø¨Ø«:</strong> ${shortUrl}<br>
                            <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${streamUrl.includes('.m3u8') ? 'HLS' : streamUrl.includes('.mpd') ? 'DASH' : 'ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±'}`);
            
            // 5. ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            playStream(streamUrl);
        }

        function playStream(url) {
            updateStatus('Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø«...', 'info');

            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            video.src = '';
            
            if (url.includes('.m3u8')) {
                playHLS(url);
            } else if (url.includes('.mpd')) {
                playDASH(url);
            } else {
                // ØªÙ†Ø³ÙŠÙ‚ ÙÙŠØ¯ÙŠÙˆ Ø¹Ø§Ø¯ÙŠ (MP4, WebM, etc.)
                playNative(url);
            }
        }

        function playHLS(url) {
            if (Hls.isSupported()) {
                updateStatus('Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… HLS.jsØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ‡ÙŠØ¦Ø©...', 'success');
                
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø´ØºÙ„ HLS Ù‚Ø¯ÙŠÙ…ØŒ Ù‚Ù… Ø¨ØªØ¯Ù…ÙŠØ±Ù‡ Ø£ÙˆÙ„Ø§Ù‹
                if (window.hlsPlayer) {
                    window.hlsPlayer.destroy();
                }
                
                const hls = new Hls({
                    debug: false,
                    enableWorker: true,
                    lowLatencyMode: true,
                    backBufferLength: 90
                });

                window.hlsPlayer = hls;
                
                hls.loadSource(url);
                hls.attachMedia(video);

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    updateStatus('âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ HLS Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âœ… Ø§Ù„Ø¨Ø« Ø¬Ø§Ù‡Ø²');
                    
                    video.play().catch(e => {
                        updateStatus('Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ' + e.message, 'error');
                        video.controls = true;
                    });
                });

                hls.on(Hls.Events.ERROR, (event, data) => {
                    updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ HLS: ' + data.details, 'error');
                    console.error('HLS Error:', data);
                    
                    if (data.fatal) {
                        switch(data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©');
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âŒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·');
                                break;
                            default:
                                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
                                break;
                        }
                    }
                });

            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Ø¯Ø¹Ù… HLS Ø§Ù„Ø£ØµÙ„ÙŠ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ù…Ø«Ù„ Safari
                updateStatus('Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… HLS Ø¨Ø´ÙƒÙ„ Ø£ØµÙ„ÙŠ', 'success');
                video.src = url;
                
                video.addEventListener('loadedmetadata', () => {
                    updateStatus('âœ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„', 'success');
                    updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âœ… Ø§Ù„Ø¨Ø« Ø¬Ø§Ù‡Ø²');
                });
                
                video.play().catch(e => {
                    updateStatus('Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ' + e.message, 'error');
                    video.controls = true;
                });
            } else {
                updateStatus('âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ ØªÙŠØ§Ø±Ø§Øª HLS.', 'error');
                updateStreamInfo('âš ï¸ Ø§Ù„Ù…ØªØµÙØ­ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø¬Ø±Ø¨ Ø§Ø³ØªØ®Ø¯Ø§Ù… Chrome Ø£Ùˆ Firefox Ø£Ùˆ Safari.');
            }
        }

        function playDASH(url) {
            updateStatus('ØªÙ‡ÙŠØ¦Ø© Ù…Ø´ØºÙ„ DASH...', 'info');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø´ØºÙ„ DASH Ù‚Ø¯ÙŠÙ…ØŒ Ù‚Ù… Ø¨ØªØ¯Ù…ÙŠØ±Ù‡ Ø£ÙˆÙ„Ø§Ù‹
            if (window.dashPlayer) {
                window.dashPlayer.destroy();
            }
            
            const player = dashjs.MediaPlayer().create();
            window.dashPlayer = player;
            
            player.updateSettings({
                streaming: {
                    delay: {
                        liveDelay: 3
                    }
                }
            });
            
            player.initialize(video, url, true);
            
            player.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, () => {
                updateStatus('âœ… ØªÙ… ØªÙ‡ÙŠØ¦Ø© ØªÙŠØ§Ø± DASH Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âœ… Ø§Ù„Ø¨Ø« Ø¬Ø§Ù‡Ø²');
            });
            
            player.on(dashjs.MediaPlayer.events.ERROR, (e) => {
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø´ØºÙ„ DASH', 'error');
                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„');
                console.error('DASH Error:', e);
            });
        }

        function playNative(url) {
            updateStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„ ÙƒÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø±...', 'info');
            
            video.src = url;
            video.load();
            
            video.addEventListener('loadeddata', () => {
                updateStatus('âœ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„', 'success');
                updateStreamInfo(streamInfoEl.innerHTML + '<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âœ… Ø§Ù„Ø¨Ø« Ø¬Ø§Ù‡Ø²');
            });
            
            video.play().catch(e => {
                updateStatus('Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ' + e.message, 'error');
                video.controls = true;
            });
        }

        function refreshStream() {
            if (currentStreamUrl) {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø«...', 'info');
                updateStreamInfo('Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…ØµØ¯Ø± Ø§Ù„Ø¨Ø«...');
                playStream(currentStreamUrl);
            } else {
                updateStatus('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø« Ø­Ø§Ù„ÙŠ Ù„ØªØ­Ø¯ÙŠØ«Ù‡', 'error');
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                } else if (video.msRequestFullscreen) {
                    video.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        video.addEventListener('error', (e) => {
            updateStatus('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'error');
            console.error('Video Error:', video.error);
            
            let errorMsg = 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            if (video.error) {
                switch(video.error.code) {
                    case 1: errorMsg = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„'; break;
                    case 2: errorMsg = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©'; break;
                    case 3: errorMsg = 'Ø®Ø·Ø£ ÙÙŠ ÙÙƒ Ø§Ù„ØªØ´ÙÙŠØ±'; break;
                    case 4: errorMsg = 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…'; break;
                }
            }
            updateStreamInfo(streamInfoEl.innerHTML + `<br><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> âŒ ${errorMsg}`);
        });

        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø´ØºÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', initPlayer);
        
        // Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„
        console.log('Leo TV Player Loaded');
        console.log('URL Parameters:', new URLSearchParams(window.location.search).toString());
    </script>
</body>
</html>
