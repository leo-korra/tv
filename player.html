<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Leo TV - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù…Ø­Ø³Ù†</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/dashjs@latest/dist/dash.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/videojs@7/dist/video.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/videojs@7/dist/video-js.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Arial', sans-serif;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 15px;
            text-align: center;
        }
        
        .header h1 {
            margin-bottom: 10px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .player-container {
            position: relative;
            width: 100%;
            background: #111;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        #video {
            width: 100%;
            height: 70vh;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }
        
        .btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .status {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            text-align: center;
        }
        
        .debug {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .error { color: #ff6b6b; }
        .success { color: #4ecdc4; }
        .warning { color: #ffd93d; }
        
        .stream-info {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Ù…Ø´ØºÙ„ Leo TV Ø§Ù„Ù…Ø­Ø³Ù†</h1>
        <p>Ø¥ØµØ¯Ø§Ø± Ù…ØªÙ‚Ø¯Ù… Ù…Ø¹ Ø¯Ø¹Ù… Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨Ø«</p>
    </div>
    
    <div class="container">
        <div class="stream-info" id="streamInfo">
            Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø«...
        </div>
        
        <div class="player-container">
            <video id="video" class="video-js vjs-default-skin" controls autoplay playsinline>
                <p class="vjs-no-js">
                    Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ÙŠØ±Ø¬Ù‰ ØªÙØ¹ÙŠÙ„ JavaScript Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… HTML5 video
                </p>
            </video>
        </div>
        
        <div class="status" id="status">
            Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø´ØºÙ„...
        </div>
        
        <div class="controls">
            <button class="btn" onclick="window.location.href='index.html'">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ù†ÙˆØ§Øª
            </button>
            <button class="btn" onclick="reloadStream()">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«
            </button>
            <button class="btn" onclick="toggleFullscreen()">
                ğŸ“º Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
            </button>
            <button class="btn" onclick="toggleDebug()">
                ğŸ› ÙˆØ¶Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­
            </button>
            <button class="btn" onclick="testAlternatePlayers()">
                ğŸ”§ ØªØ¬Ø±Ø¨Ø© Ù…Ø´ØºÙ„Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©
            </button>
        </div>
        
        <div class="debug" id="debugPanel" style="display: none;">
            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­:</h3>
            <div id="debugLog"></div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
        let currentStreamUrl = '';
        let hlsPlayer = null;
        let dashPlayer = null;
        let debugMode = false;
        
        // Ø¹Ù†Ø§ØµØ± DOM
        const video = document.getElementById('video');
        const statusEl = document.getElementById('status');
        const streamInfoEl = document.getElementById('streamInfo');
        const debugPanel = document.getElementById('debugPanel');
        const debugLog = document.getElementById('debugLog');
        
        // Ø¯Ø§Ù„Ø© ØªØ³Ø¬ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµØ­ÙŠØ­
        function logDebug(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color:${getColor(type)}">[${time}] ${message}</span>`;
            debugLog.appendChild(logEntry);
            debugLog.scrollTop = debugLog.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function getColor(type) {
            switch(type) {
                case 'error': return '#ff6b6b';
                case 'success': return '#4ecdc4';
                case 'warning': return '#ffd93d';
                default: return '#ffffff';
            }
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø´ØºÙ„
        function updateStatus(message, type = 'info') {
            statusEl.textContent = message;
            statusEl.className = type;
            logDebug(message, type);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø«
        function updateStreamInfo(info) {
            streamInfoEl.innerHTML = info;
        }
        
        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† ÙˆØ¶Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­
        function toggleDebug() {
            debugMode = !debugMode;
            debugPanel.style.display = debugMode ? 'block' : 'none';
            updateStatus(debugMode ? 'âœ… ÙˆØ¶Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­ Ù…ÙØ¹Ù„' : 'âŒ ÙˆØ¶Ø¹ Ø§Ù„ØªØµØ­ÙŠØ­ Ù…Ø¹Ø·Ù„');
        }
        
        // ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ø¯Ù‚Ø©
        async function diagnoseStream(url) {
            logDebug(`Ø¨Ø¯Ø¡ ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø·: ${url}`, 'info');
            
            const tests = [
                {
                    name: 'ÙØ­Øµ CORS Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ',
                    test: async () => {
                        try {
                            const response = await fetch(url, { mode: 'no-cors' });
                            return { success: true, message: 'Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ³ØªØ¬ÙŠØ¨ (no-cors mode)' };
                        } catch (e) {
                            return { success: false, message: `ÙØ´Ù„ no-cors: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'ÙØ­Øµ Ø¹Ø¨Ø± Proxy',
                    test: async () => {
                        try {
                            const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
                            const response = await fetch(proxyUrl);
                            const data = await response.json();
                            
                            if (data.contents) {
                                return { 
                                    success: true, 
                                    message: `âœ… Proxy Ù†Ø§Ø¬Ø­ - Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù: ${data.contents.length} Ø­Ø±Ù`
                                };
                            } else {
                                return { success: false, message: 'Proxy ÙØ´Ù„ - Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰' };
                            }
                        } catch (e) {
                            return { success: false, message: `Proxy ÙØ´Ù„: ${e.message}` };
                        }
                    }
                },
                {
                    name: 'ÙØ­Øµ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù',
                    test: async () => {
                        const isHLS = url.includes('.m3u8');
                        const isDASH = url.includes('.mpd');
                        const isMP4 = url.includes('.mp4') || url.includes('.webm');
                        
                        let type = 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
                        if (isHLS) type = 'HLS Stream (.m3u8)';
                        if (isDASH) type = 'DASH Stream (.mpd)';
                        if (isMP4) type = 'ÙÙŠØ¯ÙŠÙˆ Ù…Ø¨Ø§Ø´Ø± (MP4/WebM)';
                        
                        return { success: true, message: `Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù: ${type}` };
                    }
                }
            ];
            
            let allTestsPassed = true;
            let results = [];
            
            for (const test of tests) {
                logDebug(`Ø¬Ø§Ø±ÙŠ: ${test.name}`, 'info');
                try {
                    const result = await test.test();
                    results.push({ name: test.name, ...result });
                    
                    if (!result.success) allTestsPassed = false;
                } catch (e) {
                    results.push({ 
                        name: test.name, 
                        success: false, 
                        message: `Ø®Ø·Ø£: ${e.message}` 
                    });
                    allTestsPassed = false;
                }
            }
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
            let resultHTML = '<h4>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ÙØ­Øµ:</h4>';
            results.forEach(r => {
                resultHTML += `
                    <div style="margin: 5px 0; padding: 5px; background: ${r.success ? '#1a3c1a' : '#3c1a1a'}; border-radius: 3px;">
                        <strong>${r.name}:</strong> ${r.message}
                    </div>
                `;
            });
            
            updateStreamInfo(resultHTML);
            return allTestsPassed;
        }
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø« Ø¨Ø·Ø±Ù‚ Ù…Ø®ØªÙ„ÙØ©
        async function playStream(url) {
            currentStreamUrl = url;
            
            logDebug(`Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø·: ${url}`, 'info');
            
            // Ø£ÙˆÙ„Ø§Ù‹: ØªØ´Ø®ÙŠØµ Ø§Ù„Ø±Ø§Ø¨Ø·
            const isHealthy = await diagnoseStream(url);
            
            if (!isHealthy) {
                updateStatus('âš ï¸ Ù‚Ø¯ ÙŠÙƒÙˆÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø´Ø§ÙƒÙ„ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·', 'warning');
            }
            
            // ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ Ø§Ù„Ø¨Ø«
            if (url.includes('.m3u8')) {
                await playWithHLS(url);
            } else if (url.includes('.mpd')) {
                await playWithDASH(url);
            } else {
                await playWithNative(url);
            }
        }
        
        // ØªØ´ØºÙŠÙ„ HLS
        async function playWithHLS(url) {
            updateStatus('ğŸ¬ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ HLS...', 'info');
            
            // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 1: Hls.js
            if (Hls.isSupported()) {
                logDebug('Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Hls.js', 'success');
                
                if (hlsPlayer) {
                    hlsPlayer.destroy();
                }
                
                hlsPlayer = new Hls({
                    debug: debugMode,
                    enableWorker: true,
                    lowLatencyMode: true,
                    xhrSetup: function(xhr) {
                        // Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³Ø§Øª Ù…Ø®ØµØµØ© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
                        xhr.setRequestHeader('Access-Control-Allow-Origin', '*');
                        xhr.setRequestHeader('Access-Control-Allow-Credentials', 'true');
                    }
                });
                
                hlsPlayer.loadSource(url);
                hlsPlayer.attachMedia(video);
                
                hlsPlayer.on(Hls.Events.MANIFEST_PARSED, () => {
                    updateStatus('âœ… HLS Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„', 'success');
                    video.play().catch(e => {
                        updateStatus(`Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ${e.message}`, 'warning');
                    });
                });
                
                hlsPlayer.on(Hls.Events.ERROR, (event, data) => {
                    logDebug(`Ø®Ø·Ø£ HLS: ${data.details} - ${data.type}`, 'error');
                    
                    if (data.fatal) {
                        updateStatus('âŒ Ø®Ø·Ø£ Ù‚Ø§ØªÙ„ ÙÙŠ HLS', 'error');
                        
                        // Ø¬Ø±Ø¨ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
                        if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
                            setTimeout(() => {
                                updateStatus('ğŸ”„ Ø¬Ø±Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø©...', 'warning');
                                playWithNativeHLS(url);
                            }, 1000);
                        }
                    }
                });
                
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© 2: HLS Ø§Ù„Ø£ØµÙ„ÙŠ (Safari)
                logDebug('Ø§Ø³ØªØ®Ø¯Ø§Ù… HLS Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ù…ØªØµÙØ­', 'info');
                playWithNativeHLS(url);
            } else {
                updateStatus('âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… HLS', 'error');
            }
        }
        
        // ØªØ´ØºÙŠÙ„ HLS Ø§Ù„Ø£ØµÙ„ÙŠ
        function playWithNativeHLS(url) {
            video.src = url;
            video.load();
            
            video.addEventListener('loadedmetadata', () => {
                updateStatus('âœ… HLS Ø§Ù„Ø£ØµÙ„ÙŠ Ø¬Ø§Ù‡Ø²', 'success');
                video.play().catch(e => {
                    updateStatus(`Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ${e.message}`, 'warning');
                });
            });
            
            video.addEventListener('error', (e) => {
                updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ HLS Ø§Ù„Ø£ØµÙ„ÙŠ', 'error');
                logDebug(`Ø®Ø·Ø£ ÙÙŠØ¯ÙŠÙˆ: ${video.error ? video.error.message : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
            });
        }
        
        // ØªØ´ØºÙŠÙ„ DASH
        async function playWithDASH(url) {
            updateStatus('ğŸ¬ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ DASH...', 'info');
            
            if (typeof dashjs !== 'undefined') {
                if (dashPlayer) {
                    dashPlayer.destroy();
                }
                
                dashPlayer = dashjs.MediaPlayer().create();
                dashPlayer.initialize(video, url, true);
                
                dashPlayer.on(dashjs.MediaPlayer.events.STREAM_INITIALIZED, () => {
                    updateStatus('âœ… DASH Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„', 'success');
                });
                
                dashPlayer.on(dashjs.MediaPlayer.events.ERROR, (e) => {
                    updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ DASH', 'error');
                    logDebug(`Ø®Ø·Ø£ DASH: ${JSON.stringify(e)}`, 'error');
                });
            } else {
                updateStatus('âŒ Ù…ÙƒØªØ¨Ø© DASH ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©', 'error');
            }
        }
        
        // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        async function playWithNative(url) {
            updateStatus('ğŸ¬ Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±...', 'info');
            
            video.src = url;
            video.load();
            
            return new Promise((resolve) => {
                video.addEventListener('loadeddata', () => {
                    updateStatus('âœ… Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¬Ø§Ù‡Ø²', 'success');
                    video.play().then(() => {
                        resolve(true);
                    }).catch(e => {
                        updateStatus(`Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙØ´Ù„: ${e.message}`, 'warning');
                        resolve(false);
                    });
                });
                
                video.addEventListener('error', () => {
                    updateStatus('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'error');
                    logDebug(`Ø®Ø·Ø£ ÙÙŠØ¯ÙŠÙˆ: ${video.error ? video.error.code : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
                    resolve(false);
                });
                
                // Ù…Ù‡Ù„Ø© Ø¥Ø°Ø§ Ø§Ø³ØªØºØ±Ù‚ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø·ÙˆÙŠÙ„Ø§Ù‹
                setTimeout(() => {
                    if (video.readyState < 2) {
                        updateStatus('âš ï¸ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙŠØ³ØªØºØ±Ù‚ ÙˆÙ‚ØªØ§Ù‹ Ø·ÙˆÙŠÙ„Ø§Ù‹', 'warning');
                        resolve(false);
                    }
                }, 10000);
            });
        }
        
        // ØªØ¬Ø±Ø¨Ø© Ù…Ø´ØºÙ„Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©
        async function testAlternatePlayers() {
            if (!currentStreamUrl) return;
            
            updateStatus('ğŸ”§ Ø¬Ø±Ø¨ Ù…Ø´ØºÙ„Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©...', 'info');
            
            const players = [
                { name: 'HLS.js', method: () => playWithHLS(currentStreamUrl) },
                { name: 'HLS Ø§Ù„Ø£ØµÙ„ÙŠ', method: () => playWithNativeHLS(currentStreamUrl) },
                { name: 'Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±', method: () => playWithNative(currentStreamUrl) }
            ];
            
            for (let i = 0; i < players.length; i++) {
                updateStatus(`Ø¬Ø±Ø¨ ${players[i].name}...`, 'info');
                
                try {
                    await players[i].method();
                    updateStatus(`âœ… ${players[i].name} Ù†Ø¬Ø­`, 'success');
                    break;
                } catch (e) {
                    logDebug(`âŒ ${players[i].name} ÙØ´Ù„: ${e.message}`, 'error');
                    
                    if (i === players.length - 1) {
                        updateStatus('âŒ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø´ØºÙ„Ø§Øª ÙØ´Ù„Øª', 'error');
                    }
                }
            }
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«
        function reloadStream() {
            if (!currentStreamUrl) {
                updateStatus('âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨Ø« Ø­Ø§Ù„ÙŠØ§Ù‹', 'error');
                return;
            }
            
            updateStatus('ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«...', 'info');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            video.src = '';
            video.load();
            
            // ØªØ¯Ù…ÙŠØ± Ø§Ù„Ù…Ø´ØºÙ„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            if (hlsPlayer) {
                hlsPlayer.destroy();
                hlsPlayer = null;
            }
            
            if (dashPlayer) {
                dashPlayer.destroy();
                dashPlayer = null;
            }
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
            setTimeout(() => {
                playStream(currentStreamUrl);
            }, 500);
        }
        
        // Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (video.requestFullscreen) {
                    video.requestFullscreen();
                } else if (video.webkitRequestFullscreen) {
                    video.webkitRequestFullscreen();
                } else if (video.msRequestFullscreen) {
                    video.msRequestFullscreen();
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„
        async function initPlayer() {
            logDebug('Ø¨Ø¯Ø¡ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„...', 'info');
            
            const params = new URLSearchParams(window.location.search);
            const encodedUrl = params.get('src');
            
            if (!encodedUrl) {
                showNoStreamMessage();
                return;
            }
            
            let streamUrl;
            try {
                streamUrl = atob(decodeURIComponent(encodedUrl));
                logDebug(`ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·: ${streamUrl}`, 'success');
            } catch (e) {
                streamUrl = decodeURIComponent(encodedUrl);
                logDebug(`Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©: ${streamUrl}`, 'warning');
            }
            
            await playStream(streamUrl);
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ø±Ø§Ø¨Ø·
        function showNoStreamMessage() {
            updateStatus('âŒ Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù‚Ù†Ø§Ø©', 'error');
            
            streamInfoEl.innerHTML = `
                <div style="text-align: center; padding: 30px;">
                    <h3>Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù‚Ù†Ø§Ø© Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø©</h3>
                    <p>ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹</p>
                    <button onclick="window.location.href='index.html'" 
                            style="padding: 15px 30px; 
                                   background: linear-gradient(135deg, #667eea, #764ba2); 
                                   color: white; 
                                   border: none; 
                                   border-radius: 10px; 
                                   font-size: 18px; 
                                   cursor: pointer; 
                                   margin-top: 20px;">
                        â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
                    </button>
                    
                    <div style="margin-top: 30px;">
                        <h4>Ø£Ùˆ Ø¬Ø±Ø¨ Ø±ÙˆØ§Ø¨Ø· ØªØ¬Ø±ÙŠØ¨ÙŠØ©:</h4>
                        <button onclick="testStream('https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8')" 
                                style="padding: 10px 20px; margin: 5px;">
                            HLS ØªØ¬Ø±ÙŠØ¨ÙŠ
                        </button>
                        <button onclick="testStream('https://dash.akamaized.net/envivio/EnvivioDash3/manifest.mpd')" 
                                style="padding: 10px 20px; margin: 5px;">
                            DASH ØªØ¬Ø±ÙŠØ¨ÙŠ
                        </button>
                    </div>
                </div>
            `;
        }
        
        // ØªØ¬Ø±Ø¨Ø© Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±
        function testStream(url) {
            currentStreamUrl = url;
            updateStatus(`ğŸ”§ Ø¬Ø±Ø¨ Ø±Ø§Ø¨Ø· ØªØ¬Ø±ÙŠØ¨ÙŠ: ${url}`, 'info');
            playStream(url);
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            logDebug('ØµÙØ­Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ø­Ù…Ù„Ø©', 'success');
            initPlayer();
        });
        
        // Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ø©
        window.addEventListener('error', (e) => {
            logDebug(`Ø®Ø·Ø£ Ø¹Ø§Ù…: ${e.message} ÙÙŠ ${e.filename}:${e.lineno}`, 'error');
        });
    </script>
</body>
</html>
